{% extends 'base.html' %}
{% block content %}
{% load static %}
<div class="p-4">
  <div class="container">
    <div class="row justify-content-center mt-3">
      <div class="col-md-10 text-center mb-4">
        <h2 class="text-success">List of Pokémon</h2>
        <hr class="border-success" />
        <form method="GET" class="d-flex justify-content-center">
          <div class="input-group w-50">
            <span class="input-group-text bg-success text-white fw-semibold">Search</span>
            <input type="text" class="form-control border-success" name="search" placeholder="Search by name...">
            <button class="btn btn-success" type="submit">Go</button>
          </div>
        </form>
      </div>
    </div>

    <div class="row" id="pokemon-container">
      {% for pokemon in template_data.pokemons %}
      <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
        <div class="card shadow-sm border-0 rounded-4 h-100 text-center" style="background-color: #f8fff8;">
          <div class="p-3">
            <img src="{{ pokemon.image.url }}" class="card-img-top rounded shadow-sm" style="height: 200px; object-fit: contain;" alt="{{ pokemon.name }}">
          </div>
          <div class="card-body">
            <a href="{% url 'pokemons.show' id=pokemon.id %}" class="btn btn-success rounded-pill px-4">
              {{ pokemon.name }}
            </a>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col text-center mt-4">
        <div class="alert alert-info">No Pokémon found matching your search.</div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
<script>
  function fetchKantoPokemon() {
    fetch('https://pokeapi.co/api/v2/pokemon?limit=151')
      .then(response => response.json())
      .then(function(allpokemon) {
        allpokemon.results.forEach(function(pokemon) {
          fetchPokemonData(pokemon);
        });
      });
  }

  function fetchPokemonData(pokemon) {
    fetch(pokemon.url)
      .then(response => response.json())
      .then(function(data) {
        displayPokemon(data);
      });
  }

  function displayPokemon(pokemonData) {
    const container = document.getElementById('pokemon-container');
    const pokemonCard = `
      <div class="col-sm-6 col-md-4 col-lg-3 mb-4">
        <div class="card shadow-sm border-0 rounded-4 h-100 text-center" style="background-color: #f8fff8;">
          <div class="p-3">
            <img src="${pokemonData.sprites.front_default}" class="card-img-top rounded shadow-sm" style="height: 200px; object-fit: contain;" alt="${pokemonData.name}">
          </div>
          <div class="card-body">
            <a href="/pokemons/${pokemonData.id}" class="btn btn-success rounded-pill px-4">
              ${pokemonData.name}
            </a>
          </div>
        </div>
      </div>
    `;
    container.insertAdjacentHTML('beforeend', pokemonCard);
  }

  window.onload = function() {
    fetchKantoPokemon();
  };
</script>
{% endblock content %}
